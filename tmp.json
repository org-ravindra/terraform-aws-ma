{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "S3ListBucketPrefix",
			"Effect": "Allow",
			"Action": [
				"s3:ListBucket",
				"s3:ListBucketVersions"
			],
			"Resource": "arn:aws:s3:::ma-tfstate-bucket",
			"Condition": {
				"StringLike": {
					"s3:prefix": [
						"envs/dev/*"
					]
				}
			}
		},
		{
			"Sid": "S3StateObjectRW",
			"Effect": "Allow",
			"Action": [
				"s3:GetObject",
				"s3:PutObject",
				"s3:DeleteObject",
				"s3:GetObjectVersion"
			],
			"Resource": "arn:aws:s3:::ma-tfstate-bucket/envs/dev/*"
		},
		{
			"Sid": "DDBStateLock",
			"Effect": "Allow",
			"Action": [
				"dynamodb:DescribeTable",
				"dynamodb:GetItem",
				"dynamodb:PutItem",
				"dynamodb:DeleteItem",
				"dynamodb:UpdateItem",
				"dynamodb:Scan"
			],
			"Resource": "arn:aws:dynamodb:us-east-1:648707377185:table/ma-tfstate-locks"
		},
		{
			"Sid": "PlanReadDiscovery",
			"Effect": "Allow",
			"Action": [
				"ec2:Describe*",
				"elasticloadbalancing:Describe*",
				"autoscaling:Describe*",
				"iam:Get*",
				"iam:List*",
				"ssm:GetParameter",
				"ssm:DescribeParameters",
				"logs:Describe*",
				"cloudwatch:ListMetrics",
				"cloudwatch:Describe*",
				"ecr:Describe*",
				"ecr:GetAuthorizationToken",
				"route53:List*"
			],
			"Resource": "*"
		},
		{
			"Sid": "ELBServiceLinkedRoleCreate",
			"Effect": "Allow",
			"Action": "iam:CreateServiceLinkedRole",
			"Resource": "*",
			"Condition": {
				"StringEquals": {
					"iam:AWSServiceName": "elasticloadbalancing.amazonaws.com"
				}
			}
		},
		{
			"Sid": "ALBCreateWithTags",
			"Effect": "Allow",
			"Action": [
				"elasticloadbalancing:CreateLoadBalancer",
				"elasticloadbalancing:CreateTargetGroup",
				"elasticloadbalancing:CreateListener"
			],
			"Resource": "*",
			"Condition": {
				"StringEquals": {
					"aws:RequestTag/Project": "ma",
					"aws:RequestTag/Env": "dev"
				},
				"StringLike": {
					"aws:RequestTag/Name": "ma-*"
				}
			}
		},
		{
			"Sid": "ALBManageTagged",
			"Effect": "Allow",
			"Action": [
				"elasticloadbalancing:DeleteLoadBalancer",
				"elasticloadbalancing:DeleteTargetGroup",
				"elasticloadbalancing:DeleteListener",
				"elasticloadbalancing:RegisterTargets",
				"elasticloadbalancing:DeregisterTargets",
				"elasticloadbalancing:AddTags",
				"elasticloadbalancing:ModifyListener",
				"elasticloadbalancing:ModifyLoadBalancerAttributes",
				"elasticloadbalancing:ModifyTargetGroup",
				"elasticloadbalancing:ModifyTargetGroupAttributes"
			],
			"Resource": "*",
			"Condition": {
				"StringEquals": {
					"aws:ResourceTag/Project": "ma",
					"aws:ResourceTag/Env": "dev"
				}
			}
		},
		{
			"Sid": "Ec2SecurityGroupCreateWithTags",
			"Effect": "Allow",
			"Action": [
				"ec2:CreateSecurityGroup",
				"ec2:CreateTags"
			],
			"Resource": "*",
			"Condition": {
				"StringEquals": {
					"aws:RequestTag/Project": "ma",
					"aws:RequestTag/Env": "dev"
				},
				"StringLike": {
					"aws:RequestTag/Name": "ma-*"
				}
			}
		},
		{
			"Sid": "Ec2SecurityGroupManageTagged",
			"Effect": "Allow",
			"Action": [
				"ec2:DeleteSecurityGroup",
				"ec2:AuthorizeSecurityGroupIngress",
				"ec2:AuthorizeSecurityGroupEgress",
				"ec2:RevokeSecurityGroupIngress",
				"ec2:RevokeSecurityGroupEgress",
				"ec2:DeleteTags"
			],
			"Resource": "*",
			"Condition": {
				"StringEquals": {
					"aws:ResourceTag/Project": "ma",
					"aws:ResourceTag/Env": "dev"
				}
			}
		},
		{
			"Sid": "IamManageSpecificEc2RoleAndProfile",
			"Effect": "Allow",
			"Action": [
				"iam:CreateRole",
				"iam:DeleteRole",
				"iam:AttachRolePolicy",
				"iam:DetachRolePolicy",
				"iam:PutRolePolicy",
				"iam:DeleteRolePolicy",
				"iam:CreateInstanceProfile",
				"iam:DeleteInstanceProfile",
				"iam:AddRoleToInstanceProfile",
				"iam:RemoveRoleFromInstanceProfile"
			],
			"Resource": [
				"arn:aws:iam::648707377185:role/ma-ec2-role",
				"arn:aws:iam::648707377185:instance-profile/ma-ec2-profile"
			]
		},
		{
			"Sid": "IamPassOnlyMaEc2RoleToEc2",
			"Effect": "Allow",
			"Action": "iam:PassRole",
			"Resource": "arn:aws:iam::648707377185:role/ma-ec2-role",
			"Condition": {
				"StringEquals": {
					"iam:PassedToService": "ec2.amazonaws.com"
				}
			}
		},
		{
			"Sid": "SsmParameterRWMaPrefix",
			"Effect": "Allow",
			"Action": [
				"ssm:PutParameter",
				"ssm:GetParameter",
				"ssm:GetParameters",
				"ssm:GetParameterHistory",
				"ssm:DeleteParameter"
			],
			"Resource": "arn:aws:ssm:us-east-1:648707377185:parameter/ma/*"
		},
		{
			"Sid": "SsmDocumentsCRUDMa",
			"Effect": "Allow",
			"Action": [
				"ssm:CreateDocument",
				"ssm:UpdateDocument",
				"ssm:DeleteDocument",
				"ssm:DescribeDocument",
				"ssm:GetDocument",
				"ssm:DescribeDocumentPermission",
				"ssm:AddTagsToResource",
				"ssm:RemoveTagsFromResource"
			],
			"Resource": "arn:aws:ssm:us-east-1:648707377185:document/ma-*"
		},
		{
			"Sid": "SsmAssociationsLimited",
			"Effect": "Allow",
			"Action": [
				"ssm:CreateAssociation",
				"ssm:UpdateAssociation",
				"ssm:DeleteAssociation",
				"ssm:DescribeAssociation"
			],
			"Resource": "*"
		},
		{
			"Sid": "LogsManageMa",
			"Effect": "Allow",
			"Action": [
				"logs:CreateLogGroup",
				"logs:PutRetentionPolicy",
				"logs:CreateLogStream",
				"logs:PutLogEvents",
				"logs:DeleteLogGroup",
				"logs:DeleteLogStream",
				"logs:DescribeLogGroups",
				"logs:DescribeLogStreams",
				"logs:TagLogGroup",
				"logs:UntagLogGroup"
			],
			"Resource": [
				"arn:aws:logs:us-east-1:648707377185:log-group:ma-*",
				"arn:aws:logs:us-east-1:648707377185:log-group:ma-*:log-stream:*"
			]
		}
	]
}